---
title: Internationalization
---

# Internationalization

We use `vue-i18n` with lazy loading and caching. Only `zh-cn` is initially loaded, and other locales are loaded on demand.

## Lazy loading (excerpt)

```ts
// src/plugins/i18n.ts
const localeFiles = import.meta.glob('../../locales/*.y(a)?ml', { eager: false })
const localeCache = new Map<string, any>()

async function loadLocaleMessages(locale: string) {
  if (localeCache.has(locale)) return localeCache.get(locale)
  const localeKey = `../../locales/${locale}.yaml`
  const loader = localeFiles[localeKey]
  if (!loader) return {}
  const module = await loader() as { default: any }
  const messages = module.default || {}
  localeCache.set(locale, messages)
  return messages
}
```

## Initialization and switching (excerpt)

```ts
export const i18n = createI18n({ legacy: false, locale: 'zh-cn', fallbackLocale: 'en-us', messages: {} })

export async function initializeI18n() {
  const initial = getStoredLocale()
  const messages = await loadLocaleMessages(initial)
  i18n.global.setLocaleMessage(initial, messages)
  ;(i18n.global.locale as any).value = initial
}

export async function setLanguage(locale: string) {
  if ((i18n.global.locale as any).value === locale) return
  if (localeCache.has(locale)) { (i18n.global.locale as any).value = locale; return }
  const messages = await loadLocaleMessages(locale)
  i18n.global.setLocaleMessage(locale, messages)
  ;(i18n.global.locale as any).value = locale
}
```

## Link with TDesign components

In `src/App.vue`, inject TDesign locale via `t-config-provider`, driven by `$storage.locale`:

```vue
<t-config-provider :global-config="currentLocale">
  <router-view />
</t-config-provider>
```

`currentLocale` returns `tdesign-mobile-vue/es/locale/zh_CN` or `en_US` based on `$storage.locale`.

## Startup flow

- `initGlobalConfig(app)` injects `$storage` (with default `locale`)
- `useI18n(app)` installs the i18n plugin
- `initializeI18n()` lazy-loads and sets the initial locale messages
- `App.vue` syncs `locale.value = $storage.locale` in `onBeforeMount`

## Best practices

- Organize messages by page or module to avoid huge single files
- Pre-warm commonly used locales (fetch on first entrance) to avoid switching jank
- Provide a language switch entry in navigation
